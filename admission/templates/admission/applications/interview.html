<div class="row g-2 mb-2 ">
    <div id="MyButtons" class="d-flex mb-md-2 mb-lg-0 col-12 col-md-auto"></div>
    <div class="form-group col-12 col-sm-auto flex-sm-grow-1 flex-lg-grow-0 ms-lg-auto">
        <select name="interview_type" id="interview_type" class="form-select me-md-2">
            <option value="">All Setup</option>
            <option value="Face-to-Face">Face-to-Face</option>
            <option value="Online">Online</option>
        </select>
    </div>
    <div class="form-group col-12 col-sm-auto flex-sm-grow-1 flex-lg-grow-0">
        <select name="program" id="program" class="form-select me-md-2">
            <option value="">All Program</option>
            {% for program in programs %}
            <option value="{{ program.code }}">{{ program.code }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="input-group search-keyword col-12 flex-lg-grow-1">
        <input type="text" name="keyword" id="keyword" placeholder="Search Student" class="form-control">
        <button class="btn btn-outline-secondary background-color-green" type="button"><i class="fas fa-search white"></i></button>
    </div>
</div>
<table class="table table-hover responsive" id="table-interview">
    <thead>
        <tr>
            <th scope="col">Action</th>
            <th scope="col">Name</th>
            <th scope="col">Program</th>
            <th scope="col">CET OAPR</th>
            <th scope="col">SHS GPA</th>
            <th scope="col">Email Address</th>
            <th scope="col">Phone Number</th>
            <th scope="col">Date & Time</th>
            <th scope="col">Setup</th>
        </tr>
    </thead>
    <tbody>
        {% for application in applications %}
        <tr>
            <td>
                <div class="action-button">
                    <a title="Rate Student Interview" href="" class="me-2 green rate-interview" id="{{ application.admissionapplication_set.first.interviewlogs_set.first.id }}" data="{{ application.admissionapplication_set.first.interviewlogs_set.first.id }}"><i class="fa-solid fa-pen-to-square"></i></a>
                    <a title="View Student Profile" class="me-2 green view-profile" data="{{ application.id }}"><i class="fa-solid fa-eye"></i></a>
                </div>
            </td>
            <td>{{ application.last_name }}, {{ application.first_name }} {{ application.middle_name }}</td>
            <td>{{ application.admissionapplication_set.first.program.code }}</td>
            <td>{{ application.collegeentrancetest_set.first.overall_percentile_rank }}</td>
            <td>{{ application.schoolbackground_set.first.combined_gpa }}</td>
            <td>{{ application.contactpoint_set.first.contact_email }}</td>
            <td>{{ application.contactpoint_set.first.contact_number }}</td>
            <td>
                {{ application.admissionapplication_set.first.interviewlogs_set.first.interview.interview_date }}
                {{ application.admissionapplication_set.first.interviewlogs_set.first.interview.interview_time }}
            </td>
            <td>{{ application.admissionapplication_set.first.interviewlogs_set.first.interview.setup }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    $(document).ready(function(){
        $('span.interview-counter').text({{ applications.count }})

        dataTable = $("#table-interview").DataTable({
            dom: 'Brtp',
            responsive: true,
            fixedHeader: true,
            buttons: [
                {
                    extend: 'excel',
                    text: 'Excel',
                    className: 'border-white'
                },
                {
                    extend: 'pdf',
                    text: 'PDF',
                    className: 'border-white'
                },
                {
                    extend: 'print',
                    text: 'Print',
                    className: 'border-white'
                }
            ],
        });
        dataTable.buttons().container().appendTo($('#MyButtons'));

        var table = dataTable;
        var filter = createFilter(table, [1, 3, 4, 5, 6, 7]);

        function createFilter(table, columns) {
            var input = $('input#keyword').on("keyup", function() {
                table.draw();
            });
          
            $.fn.dataTable.ext.search.push(function(
                settings,
                searchData,
                index,
                rowData,
                counter
            ) {
                var val = input.val().toLowerCase();
            
                for (var i = 0, ien = columns.length; i < ien; i++) {
                    if (searchData[columns[i]].toLowerCase().indexOf(val) !== -1) {
                    return true;
                    }
                }
          
                return false;
            });
          
            return input;
        }

        $('select#interview_type').on('change', function(e){
            var status = $(this).val();
            dataTable.columns([8]).search(status).draw();
        });
        $('select#program').on('change', function(e){
            var status = $(this).val();
            dataTable.columns([2]).search(status).draw();
        });
    })
</script>